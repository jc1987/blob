function Vector(a,b){this.x=a;this.y=b;this.equal=function(c){return this.x==c.getX()&&this.y==c.getY()};this.getX=function(){return this.x};this.getY=function(){return this.y};this.setX=function(c){this.x=c};this.setY=function(c){this.y=c};this.addX=function(c){this.x+=c};this.addY=function(c){this.y+=c};this.set=function(c){this.x=c.getX();this.y=c.getY()};this.add=function(c){this.x+=c.getX();this.y+=c.getY()};this.sub=function(c){this.x-=c.getX();this.y-=c.getY()};this.dotProd=function(c){return this.x*c.getX()+this.y*c.getY()};this.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};this.scale=function(c){this.x*=c;this.y*=c};this.toString=function(){return" X: "+this.x+" Y: "+this.y}}function Environment(a,d,b,c){this.left=a;this.right=a+b;this.top=d;this.buttom=d+c;this.r=new Vector(0,0);this.collision=function(g,e){var h=false;var f;if(g.getX()<this.left){g.setX(this.left);h=true}else{if(g.getX()>this.right){g.setX(this.right);h=true}}if(g.getY()<this.top){g.setY(this.top);h=true}else{if(g.getY()>this.buttom){g.setY(this.buttom);h=true}}return h};this.draw=function(e,f){}}function PointMass(a,c,b){this.cur=new Vector(a,c);this.prev=new Vector(a,c);this.mass=b;this.force=new Vector(0,0);this.result=new Vector(0,0);this.friction=0.01;this.getXPos=function(){return this.cur.getX()};this.getYPos=function(){return this.cur.getY()};this.getPos=function(){return this.cur};this.getXPrevPos=function(){return this.prev.getX()};this.getYPrevPos=function(){return this.prev.getY()};this.getPrevPos=function(){return this.prev};this.addXPos=function(d){this.cur.addX(d)};this.addYPos=function(d){this.cur.addY(d)};this.setForce=function(d){this.force.set(d)};this.addForce=function(d){this.force.add(d)};this.getMass=function(){return this.mass};this.setMass=function(d){this.mass=d};this.move=function(g){var f,e,h,d;d=g*g;e=this.force.getX()/this.mass;h=this.cur.getX();f=(2-this.friction)*h-(1-this.friction)*this.prev.getX()+e*d;this.prev.setX(h);this.cur.setX(f);e=this.force.getY()/this.mass;h=this.cur.getY();f=(2-this.friction)*h-(1-this.friction)*this.prev.getY()+e*d;this.prev.setY(h);this.cur.setY(f)};this.setFriction=function(d){this.friction=d};this.getVelocity=function(){var d,e;d=this.cur.getX()-this.prev.getX();e=this.cur.getY()-this.prev.getY();return d*d+e*e};this.draw=function(d,e){d.lineWidth=2;d.fillStyle="#000000";d.strokeStyle="#000000";d.beginPath();d.arc(this.cur.getX()*e,this.cur.getY()*e,4,0,Math.PI*2,true);d.fill()}}function ConstraintY(c,d,b,a){this.pointMass=c;this.y=d;this.delta=new Vector(0,0);this.shortConst=b;this.longConst=a;this.sc=function(){var f;f=Math.abs(this.pointMass.getYPos()-this.y);this.delta.setY(-f);if(this.shortConst!=0&&f<this.shortConst){var e;e=this.shortConst/f;this.delta.scale(e);c.getPos().sub(this.delta)}else{if(this.longConst!=0&&f>this.longConst){var e;e=this.longConst/f;this.delta.scale(e);c.getPos().sub(this.delta)}}}}function Joint(c,b,d,a){this.pointMassA=c;this.pointMassB=b;this.delta=new Vector(0,0);this.pointMassAPos=c.getPos();this.pointMassBPos=b.getPos();this.delta.set(this.pointMassBPos);this.delta.sub(this.pointMassAPos);this.shortConst=this.delta.length()*d;this.longConst=this.delta.length()*a;this.scSquared=this.shortConst*this.shortConst;this.lcSquared=this.longConst*this.longConst;this.setDist=function(f,e){this.shortConst=f;this.longConst=e;this.scSquared=this.shortConst*this.shortConst;this.lcSquared=this.longConst*this.longConst};this.scale=function(e){this.shortConst=this.shortConst*e;this.longConst=this.longConst*e;this.scSquared=this.shortConst*this.shortConst;this.lcSquared=this.longConst*this.longConst};this.sc=function(){this.delta.set(this.pointMassBPos);this.delta.sub(this.pointMassAPos);var f=this.delta.dotProd(this.delta);if(this.shortConst!=0&&f<this.scSquared){var e;e=this.scSquared/(f+this.scSquared)-0.5;this.delta.scale(e);this.pointMassAPos.sub(this.delta);this.pointMassBPos.add(this.delta)}else{if(this.longConst!=0&&f>this.lcSquared){var e;e=this.lcSquared/(f+this.lcSquared)-0.5;this.delta.scale(e);this.pointMassAPos.sub(this.delta);this.pointMassBPos.add(this.delta)}}}}function Stick(c,b){function a(f,e){var d,g;d=f.getXPos()-e.getXPos();g=f.getYPos()-e.getYPos();return Math.sqrt(d*d+g*g)}this.length=a(c,b);this.lengthSquared=this.length*this.length;this.pointMassA=c;this.pointMassB=b;this.delta=new Vector(0,0);this.getPointMassA=function(){return this.pointMassA};this.getPointMassB=function(){return this.pointMassB};this.scale=function(d){this.length*=d;this.lengthSquared=this.length*this.length};this.sc=function(f){var h,g;var e,d;e=this.pointMassA.getPos();d=this.pointMassB.getPos();this.delta.set(d);this.delta.sub(e);h=this.delta.dotProd(this.delta);g=this.lengthSquared/(h+this.lengthSquared)-0.5;this.delta.scale(g);e.sub(this.delta);d.add(this.delta)};this.setForce=function(d){this.pointMassA.setForce(d);this.pointMassB.setForce(d)};this.addForce=function(d){this.pointMassA.addForce(d);this.pointMassB.addForce(d)};this.move=function(d){this.pointMassA.move(d);this.pointMassB.move(d)};this.draw=function(d,e){this.pointMassA.draw(d,e);this.pointMassB.draw(d,e);d.lineWidth=3;d.fillStyle="#000000";d.strokeStyle="#000000";d.beginPath();d.moveTo(this.pointMassA.getXPos()*e,this.pointMassA.getYPos()*e);d.lineTo(this.pointMassB.getXPos()*e,this.pointMassB.getYPos()*e);d.stroke()}}function Spring(d,a,e,c,b){this.restLength=d;this.stiffness=a;this.damper=e;this.pointMassA=c;this.pointMassB=b;this.tmp=Vector(0,0);this.sc=function(f){f.collistion(this.pointMassA.getPos(),this.pointMassA.getPrevPos());f.collistion(this.pointMassB.getPos(),this.pointMassB.getPrevPos())};this.move=function(g){var n;var f;var l;var h;n=this.pointMassA.getXPos()-this.pointMassB.getXPos();f=this.pointMassA.getYPos()-this.pointMassB.getYPos();h=Math.sqrt(n*n+f*f);l=this.stiffness*(h/this.restLength-1);var o;var m;var k;o=this.pointMassA.getXVel()-this.pointMassB.getXVel();m=this.pointMassA.getYVel()-this.pointMassB.getYVel();k=o*n+m*f;k*=this.damper;var j;var i;j=(l+k)*n;i=(l+k)*f;this.tmp.setX(-j);this.tmp.setY(-ft);this.pointMassA.addForce(this.tmp);this.tmp.setX(j);this.tmp.setY(ft);this.pointMassB.addForce(this.tmp);this.pointMassA.move(g);this.pointMassB.move(g)};this.addForce=function(f){this.pointMassA.addForce(f);this.pointMassB.addForce(f)};this.draw=function(f,g){this.pointMassA.draw(f,g);this.pointMassB.draw(f,g);f.fillStyle="#000000";f.strokeStyle="#000000";f.beginPath();f.moveTo(this.pointMassA.getXPos()*g,this.pointMassA.getYPos()*g);f.lineTo(this.pointMassB.getXPos()*g,this.pointMassB.getXPos()*g);f.stroke()}}function Blob(j,h,e,l){this.x=j;this.y=h;this.sticks=new Array();this.pointMasses=new Array();this.joints=new Array();this.middlePointMass;this.radius=e;this.drawFaceStyle=1;this.drawEyeStyle=1;this.selected=false;l=8;var d=0.1;var g=0.95,b=1.05;var m,c,a;function k(f,i){f+=i;return f%i}for(c=0,m=0;c<l;c++){this.pointMasses[c]=new PointMass(Math.cos(m)*e+j,Math.sin(m)*e+h,1);m+=2*Math.PI/l}this.middlePointMass=new PointMass(j,h,1);this.pointMasses[0].setMass(4);this.pointMasses[1].setMass(4);for(c=0;c<l;c++){this.sticks[c]=new Stick(this.pointMasses[c],this.pointMasses[k(c+1,l)])}for(c=0,a=0;c<l;c++){this.joints[a++]=new Joint(this.pointMasses[c],this.pointMasses[k(c+l/2+1,l)],g,b);this.joints[a++]=new Joint(this.pointMasses[c],this.middlePointMass,b*0.9,g*1.1)}this.addBlob=function(f){var i=this.joints.length;var n;this.joints[i]=new Joint(this.middlePointMass,f.getMiddlePointMass(),0,0);n=this.radius+f.getRadius();this.joints[i].setDist(n*0.95,0)};this.getMiddlePointMass=function(){return this.middlePointMass};this.getRadius=function(){return this.radius};this.getXPos=function(){return this.middlePointMass.getXPos()};this.getYPos=function(){return this.middlePointMass.getYPos()};this.scale=function(n){var f;for(f=0;f<this.joints.length;f++){this.joints[f].scale(n)}for(f=0;f<this.sticks.length;f++){this.sticks[f].scale(n)}this.radius*=n};this.move=function(n){var f;for(f=0;f<this.pointMasses.length;f++){this.pointMasses[f].move(n)}this.middlePointMass.move(n)};this.sc=function(o){var n,f;for(f=0;f<4;f++){for(n=0;n<this.pointMasses.length;n++){if(o.collision(this.pointMasses[n].getPos(),this.pointMasses[n].getPrevPos())==true){this.pointMasses[n].setFriction(0.75)}else{this.pointMasses[n].setFriction(0.01)}}for(n=0;n<this.sticks.length;n++){this.sticks[n].sc(o)}for(n=0;n<this.joints.length;n++){this.joints[n].sc()}}};this.setForce=function(n){var f;for(f=0;f<this.pointMasses.length;f++){this.pointMasses[f].setForce(n)}this.middlePointMass.setForce(n)};this.addForce=function(n){var f;for(f=0;f<this.pointMasses.length;f++){this.pointMasses[f].addForce(n)}this.middlePointMass.addForce(n);this.pointMasses[0].addForce(n);this.pointMasses[0].addForce(n);this.pointMasses[0].addForce(n);this.pointMasses[0].addForce(n)};this.moveTo=function(f,p){var n,o;o=this.middlePointMass.getPos();f-=o.getX(f);p-=o.getY(p);for(n=0;n<this.pointMasses.length;n++){o=this.pointMasses[n].getPos();o.addX(f);o.addY(p)}o=this.middlePointMass.getPos();o.addX(f);o.addY(p)};this.setSelected=function(f){this.selected=f};this.drawEars=function(f,i){f.strokeStyle="#000000";f.fillStyle="#FFFFFF";f.lineWidth=2;f.beginPath();f.moveTo((-0.55*this.radius)*i,(-0.35*this.radius)*i);f.lineTo((-0.52*this.radius)*i,(-0.55*this.radius)*i);f.lineTo((-0.45*this.radius)*i,(-0.4*this.radius)*i);f.fill();f.stroke();f.beginPath();f.moveTo((0.55*this.radius)*i,(-0.35*this.radius)*i);f.lineTo((0.52*this.radius)*i,(-0.55*this.radius)*i);f.lineTo((0.45*this.radius)*i,(-0.4*this.radius)*i);f.fill();f.stroke()};this.drawHappyEyes1=function(f,i){f.lineWidth=1;f.fillStyle="#FFFFFF";f.beginPath();f.arc((-0.15*this.radius)*i,(-0.2*this.radius)*i,this.radius*0.12*i,0,2*Math.PI,false);f.fill();f.stroke();f.beginPath();f.arc((0.15*this.radius)*i,(-0.2*this.radius)*i,this.radius*0.12*i,0,2*Math.PI,false);f.fill();f.stroke();f.fillStyle="#000000";f.beginPath();f.arc((-0.15*this.radius)*i,(-0.17*this.radius)*i,this.radius*0.06*i,0,2*Math.PI,false);f.fill();f.beginPath();f.arc((0.15*this.radius)*i,(-0.17*this.radius)*i,this.radius*0.06*i,0,2*Math.PI,false);f.fill()};this.drawHappyEyes2=function(f,i){f.lineWidth=1;f.fillStyle="#FFFFFF";f.beginPath();f.arc((-0.15*this.radius)*i,(-0.2*this.radius)*i,this.radius*0.12*i,0,2*Math.PI,false);f.stroke();f.beginPath();f.arc((0.15*this.radius)*i,(-0.2*this.radius)*i,this.radius*0.12*i,0,2*Math.PI,false);f.stroke();f.lineWidth=1;f.beginPath();f.moveTo((-0.25*this.radius)*i,(-0.2*this.radius)*i);f.lineTo((-0.05*this.radius)*i,(-0.2*this.radius)*i);f.stroke();f.beginPath();f.moveTo((0.25*this.radius)*i,(-0.2*this.radius)*i);f.lineTo((0.05*this.radius)*i,(-0.2*this.radius)*i);f.stroke()};this.drawHappyFace1=function(f,i){f.lineWidth=2;f.strokeStyle="#000000";f.fillStyle="#000000";f.beginPath();f.arc(0,0,this.radius*0.25*i,0,Math.PI,false);f.stroke()};this.drawHappyFace2=function(f,i){f.lineWidth=2;f.strokeStyle="#000000";f.fillStyle="#000000";f.beginPath();f.arc(0,0,this.radius*0.25*i,0,Math.PI,false);f.fill()};this.drawOohFace=function(f,i){f.lineWidth=2;f.strokeStyle="#000000";f.fillStyle="#000000";f.beginPath();f.arc(0,(0.1*this.radius)*i,this.radius*0.25*i,0,Math.PI,false);f.fill();f.beginPath();f.moveTo((-0.25*this.radius)*i,(-0.3*this.radius)*i);f.lineTo((-0.05*this.radius)*i,(-0.2*this.radius)*i);f.lineTo((-0.25*this.radius)*i,(-0.1*this.radius)*i);f.moveTo((0.25*this.radius)*i,(-0.3*this.radius)*i);f.lineTo((0.05*this.radius)*i,(-0.2*this.radius)*i);f.lineTo((0.25*this.radius)*i,(-0.1*this.radius)*i);f.stroke()};this.drawFace=function(f,i){if(this.drawFaceStyle==1&&Math.random()<0.05){this.drawFaceStyle=2}else{if(this.drawFaceStyle==2&&Math.random()<0.1){this.drawFaceStyle=1}}if(this.drawEyeStyle==1&&Math.random()<0.025){this.drawEyeStyle=2}else{if(this.drawEyeStyle==2&&Math.random()<0.3){this.drawEyeStyle=1}}if(this.middlePointMass.getVelocity()>0.004){this.drawOohFace(f,i)}else{if(this.drawFaceStyle==1){this.drawHappyFace1(f,i,0,-0.3)}else{this.drawHappyFace2(f,i,0,-0.3)}if(this.drawEyeStyle==1){this.drawHappyEyes1(f,i,0,-0.3)}else{this.drawHappyEyes2(f,i,0,-0.3)}}};this.getPointMass=function(f){f+=this.pointMasses.length;f=f%this.pointMasses.length;return this.pointMasses[f]};this.drawBody=function(A,w){var q;A.strokeStyle="#000000";if(this.selected==true){A.fillStyle="#FFCCCC"}else{A.fillStyle="#FFFFFF"}A.lineWidth=5;A.beginPath();A.moveTo(this.pointMasses[0].getXPos()*w,this.pointMasses[0].getYPos()*w);for(q=0;q<this.pointMasses.length;q++){var y,x,t,s,r,p,o,n;var v,z,u,f;v=this.getPointMass(q-1);z=this.pointMasses[q];u=this.getPointMass(q+1);f=this.getPointMass(q+2);r=u.getXPos();p=u.getYPos();o=z.getXPos();n=z.getYPos();y=o*0.5+r*0.5;x=n*0.5+p*0.5;t=o-v.getXPos()+r-f.getXPos();s=n-v.getYPos()+p-f.getYPos();y+=t*0.16;x+=s*0.16;y=y*w;x=x*w;r=r*w;p=p*w;A.bezierCurveTo(y,x,r,p,r,p)}A.closePath();A.stroke();A.fill()};this.drawSimpleBody=function(f,i){for(c=0;c<this.sticks.length;c++){this.sticks[c].draw(f,i)}};this.draw=function(n,q){var p;var f,r,o;this.drawBody(n,q);n.strokeStyle="#000000";n.fillStyle="#000000";n.save();n.translate(this.middlePointMass.getXPos()*q,(this.middlePointMass.getYPos()-0.35*this.radius)*q);f=new Vector(0,-1);r=new Vector(0,0);r.set(this.pointMasses[0].getPos());r.sub(this.middlePointMass.getPos());o=Math.acos(r.dotProd(f)/r.length());if(r.getX()<0){n.rotate(-o)}else{n.rotate(o)}this.drawFace(n,q);n.restore()}}function BlobCollective(a,d,c,b){this.maxNum=b;this.numActive=1;this.blobs=new Array();this.tmpForce=new Vector(0,0);this.selectedBlob=null;this.blobs[0]=new Blob(a,d,0.4,8);this.split=function(){var j,h=0,k=0;var g;var f,e;if(this.numActive==this.maxNum){return}g=this.blobs.length;for(j=0;j<this.blobs.length;j++){if(this.blobs[j]!=null&&this.blobs[j].getRadius()>k){k=this.blobs[j].getRadius();f=this.blobs[j]}else{if(this.blobs[j]==null){g=j}}}f.scale(0.75);e=new Blob(f.getXPos(),f.getYPos(),f.getRadius(),8);for(j=0;j<this.blobs.length;j++){if(this.blobs[j]==null){continue}this.blobs[j].addBlob(e);e.addBlob(this.blobs[j])}this.blobs[g]=e;this.numActive++};this.findSmallest=function(e){var h=1000,f;var g;for(g=0;g<this.blobs.length;g++){if(g==e||this.blobs[g]==null){continue}if(this.blobs[g].getRadius()<h){f=g;h=this.blobs[g].getRadius()}}return f};this.findClosest=function(g){var m=1000,l,k,n,f;var h;var j,e;j=this.blobs[g].getMiddlePointMass();for(h=0;h<this.blobs.length;h++){if(h==g||this.blobs[h]==null){continue}e=this.blobs[h].getMiddlePointMass();n=j.getXPos()-e.getXPos();f=j.getYPos()-e.getYPos();k=n*n+f*f;if(k<m){m=k;l=h}}return l};this.join=function(){var i,h,k,j;var g,f,e;if(this.numActive==1){return}i=this.findSmallest(-1);h=this.findClosest(i);g=this.blobs[i].getRadius();f=this.blobs[h].getRadius();e=Math.sqrt(g*g+f*f);this.blobs[i]=null;this.blobs[h].scale(0.945*e/f);this.numActive--};this.selectBlob=function(e,l){var j,f=10000;var k;var g;var h=null;if(this.selectedBlob!=null){return}for(j=0;j<this.blobs.length;j++){if(this.blobs[j]==null){continue}k=this.blobs[j].getMiddlePointMass();aXbX=e-k.getXPos();aYbY=l-k.getYPos();dist=aXbX*aXbX+aYbY*aYbY;if(dist<f){f=dist;if(dist<this.blobs[j].getRadius()*0.5){this.selectedBlob=this.blobs[j];h={x:aXbX,y:aYbY}}}}if(this.selectedBlob!=null){this.selectedBlob.setSelected(true)}return h};this.unselectBlob=function(){if(this.selectedBlob==null){return}this.selectedBlob.setSelected(false);this.selectedBlob=null};this.selectedBlobMoveTo=function(e,f){if(this.selectedBlob==null){return}this.selectedBlob.moveTo(e,f)};this.move=function(f){var e;for(e=0;e<this.blobs.length;e++){if(this.blobs[e]==null){continue}this.blobs[e].move(f)}};this.sc=function(f){var e;for(e=0;e<this.blobs.length;e++){if(this.blobs[e]==null){continue}this.blobs[e].sc(f)}if(this.blobAnchor!=null){this.blobAnchor.sc()}};this.setForce=function(f){var e;for(e=0;e<this.blobs.length;e++){if(this.blobs[e]==null){continue}if(this.blobs[e]==this.selectedBlob){this.blobs[e].setForce(new Vector(0,0));continue}this.blobs[e].setForce(f)}};this.addForce=function(f){var e;for(e=0;e<this.blobs.length;e++){if(this.blobs[e]==null){continue}if(this.blobs[e]==this.selectedBlob){continue}this.tmpForce.setX(f.getX()*(Math.random()*0.75+0.25));this.tmpForce.setY(f.getY()*(Math.random()*0.75+0.25));this.blobs[e].addForce(this.tmpForce)}};this.draw=function(e,g){var f;for(f=0;f<this.blobs.length;f++){if(this.blobs[f]==null){continue}this.blobs[f].draw(e,g)}}}function debug(c,b,a){if(confirm(c)==true&&b!=null){b()}else{if(a!=null){a()}}}var env;var width=1000;var height=800;var scaleFactor=200;var blobColl;var gravity;var stopped;var savedMouseCoords=null;var selectOffset=null;function update(){var a=0.05;if(savedMouseCoords!=null&&selectOffset!=null){blobColl.selectedBlobMoveTo(savedMouseCoords.x-selectOffset.x,savedMouseCoords.y-selectOffset.y)}blobColl.move(a);blobColl.sc(env);blobColl.setForce(gravity)}function draw(){var b=document.getElementById("blob");if(b.getContext==null){return}var a=b.getContext("2d");a.clearRect(0,0,width,height);env.draw(a,scaleFactor);blobColl.draw(a,scaleFactor)}function timeout(){draw();update();if(stopped==false){setTimeout("timeout()",30)}}function init(){var a=document.getElementById("blob");if(a.getContext==null){alert("You need Firefox version 1.5 or higher for this to work, sorry.");return}document.onkeydown=function(c){var d;if(c==null){d=window.event.keyCode}else{d=c.keyCode}switch(d){case 37:blobColl.addForce(new Vector(-50,0));break;case 38:blobColl.addForce(new Vector(0,-50));break;case 39:blobColl.addForce(new Vector(50,0));break;case 40:blobColl.addForce(new Vector(0,50));break;case 74:blobColl.join();break;case 72:blobColl.split();break;case 71:toggleGravity();break;default:break}};function b(c){if(c==null){c=window.event}if(c==null){return null}if(c.pageX||c.pageY){return{x:c.pageX/scaleFactor,y:c.pageY/scaleFactor}}return null}document.onmousedown=function(d){var c;if(stopped==true){return}c=b(d);if(c==null){return}selectOffset=blobColl.selectBlob(c.x,c.y)};document.onmouseup=function(c){blobColl.unselectBlob();savedMouseCoords=null;selectOffset=null};document.onmousemove=function(d){var c;if(stopped==true){return}if(selectOffset==null){return}c=b(d);if(c==null){return}blobColl.selectedBlobMoveTo(c.x-selectOffset.x,c.y-selectOffset.y);savedMouseCoords=c};env=new Environment(0.2,0.2,2.6,1.6);blobColl=new BlobCollective(1,1,1,200);gravity=new Vector(0,10);stopped=false;timeout()}function stop(){stopped=true}function start(){stopped=false;timeout()}function toggleGravity(){if(gravity.getY()>0){gravity.setY(0)}else{gravity.setY(10)}}function goSplit(){for(var a=0;a<10;a++){blobColl.split()}};